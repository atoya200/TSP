<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa TSP con Animación</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
</head>
<body>
    <div id="map" style="width: 100%; height: 500px;"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Inicializa el mapa centrado en la primera ubicación
            const map = L.map('map').setView([40.7128, -74.0060], 5);

            // Agrega el tile layer de OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap'
            }).addTo(map);

            // Lista de waypoints en el orden óptimo del TSP
            const waypoints = [
                [40.7128, -74.0060],  // Nueva York
                [41.8781, -87.6298],  // Chicago
                [29.7604, -95.3698],  // Houston
                [34.0522, -118.2437], // Los Ángeles
                [37.7749, -122.4194], // San Francisco
                [40.7128, -74.0060]   // Regreso a Nueva York
            ];

            // Añade una línea poligonal para la ruta óptima (sin animación)
            const routeLine = L.polyline(waypoints, { color: 'blue' }).addTo(map);

            // Marcador para el viajante que se moverá a través de la ruta
            const travelerMarker = L.marker(waypoints[0]).addTo(map);

            // Índice y función de animación
            let index = 0;

            function animateRoute() {
                if (index < waypoints.length - 1) {
                    // Obtiene el punto actual y el siguiente
                    const startPoint = waypoints[index];
                    const endPoint = waypoints[index + 1];

                    // Mueve el marcador del viajante con una animación entre puntos
                    moveMarker(travelerMarker, startPoint, endPoint, 1000, () => {
                        index++;
                        animateRoute(); // Llama a la siguiente animación
                    });
                }
            }

            // Función para mover el marcador con una animación suave entre dos puntos
            function moveMarker(marker, start, end, duration, callback) {
                const startLatLng = L.latLng(start);
                const endLatLng = L.latLng(end);
                const steps = 50; // Cantidad de pasos en la animación
                const stepDuration = duration / steps;
                let step = 0;

                const move = setInterval(() => {
                    step++;
                    if (step > steps) {
                        clearInterval(move);
                        callback();
                    } else {
                        // Calcula la posición intermedia
                        const lat = startLatLng.lat + (endLatLng.lat - startLatLng.lat) * (step / steps);
                        const lng = startLatLng.lng + (endLatLng.lng - startLatLng.lng) * (step / steps);
                        marker.setLatLng([lat, lng]);
                    }
                }, stepDuration);
            }

            // Inicia la animación de la ruta
            animateRoute();
        });
    </script>
</body>
</html>
